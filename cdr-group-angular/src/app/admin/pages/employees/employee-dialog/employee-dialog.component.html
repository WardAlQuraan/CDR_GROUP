<app-base-dialog [title]="dialogTitle" [saveLabel]="saveLabel" [saveDisabled]="form.invalid" [loading]="loading"
  (save)="onSubmit()" (cancel)="onCancel()">

  <form [formGroup]="form" class="dialog-form">
    <!-- Basic Info Section -->
    <div class="form-section section-primary">
      <div class="section-header">
        <div class="section-icon">
          <mat-icon>person</mat-icon>
        </div>
        <div class="section-title">{{ 'admin.employees.basicInfo' | translate }}</div>
      </div>

      <div class="section-content">
        <app-form-field formControlName="employeeCode" label="admin.employees.code" icon="badge"
          placeholder="admin.employees.placeholders.code"
          [errors]="[{name: 'required', message: 'admin.employees.errors.codeRequired'}]">
        </app-form-field>

        <div class="form-row">
          <app-form-field formControlName="firstNameEn" label="admin.employees.firstNameEn" icon="person"
            placeholder="admin.employees.placeholders.firstNameEn"
            [errors]="[{name: 'required', message: 'admin.employees.errors.firstNameEnRequired'}]">
          </app-form-field>

          <app-form-field formControlName="lastNameEn" label="admin.employees.lastNameEn" icon="person"
            placeholder="admin.employees.placeholders.lastNameEn"
            [errors]="[{name: 'required', message: 'admin.employees.errors.lastNameEnRequired'}]">
          </app-form-field>
        </div>

        <div class="form-row">
          <app-form-field formControlName="firstNameAr" label="admin.employees.firstNameAr" icon="person"
            placeholder="admin.employees.placeholders.firstNameAr" dir="rtl"
            [errors]="[{name: 'required', message: 'admin.employees.errors.firstNameArRequired'}]">
          </app-form-field>

          <app-form-field formControlName="lastNameAr" label="admin.employees.lastNameAr" icon="person"
            placeholder="admin.employees.placeholders.lastNameAr" dir="rtl"
            [errors]="[{name: 'required', message: 'admin.employees.errors.lastNameArRequired'}]">
          </app-form-field>
        </div>
      </div>
    </div>

    <!-- Contact Info Section -->
    <div class="form-section section-blue">
      <div class="section-header">
        <div class="section-icon">
          <mat-icon>contact_mail</mat-icon>
        </div>
        <div class="section-title">{{ 'admin.employees.contactInfo' | translate }}</div>
      </div>

      <div class="section-content">
        <div class="form-row">
          <app-form-field formControlName="email" type="email" label="admin.employees.email" icon="email"
            placeholder="admin.employees.placeholders.email"
            [errors]="[{name: 'email', message: 'admin.employees.errors.emailInvalid'}]">
          </app-form-field>

          <app-form-field formControlName="phone" label="admin.employees.phone" icon="phone"
            placeholder="admin.employees.placeholders.phone">
          </app-form-field>
        </div>
      </div>
    </div>

    <!-- Work Info Section -->
    <div class="form-section section-orange">
      <div class="section-header">
        <div class="section-icon">
          <mat-icon>work</mat-icon>
        </div>
        <div class="section-title">{{ 'admin.employees.workInfo' | translate }}</div>
      </div>

      <div class="section-content">
        <div class="form-row">
          <app-async-select formControlName="departmentId" label="admin.employees.department" icon="business"
            [showNullOption]="false" [required]="true" [dataSource$]="departmentsDataSource$"
            [optionMapper]="departmentMapper" [resetOnDataSourceChange]="false"
            (selectionChange)="onDepartmentChange($event)">
          </app-async-select>
        </div>
        <div class="form-row">
          <app-async-select formControlName="positionId" label="admin.employees.position" icon="work_outline"
            nullOptionLabel="admin.employees.noPosition" [dataSource$]="positionsDataSource$"
            [optionMapper]="positionMapper" [filterFn]="positionFilter">
          </app-async-select>
        </div>
        <div class="form-row row">
          <app-date-picker formControlName="hireDate" label="admin.employees.hireDate" icon="event">
          </app-date-picker>

          <app-form-field formControlName="salary" type="number" label="admin.employees.salary" textPrefix="JOD"
            placeholder="admin.employees.placeholders.salary"
            [errors]="[{name: 'min', message: 'admin.employees.errors.salaryMin'}]">
          </app-form-field>
        </div>

        @if (isEditMode && salaryChanged) {
          <app-form-field formControlName="salaryChangeReason" label="admin.employees.salaryChangeReason" icon="edit_note"
            placeholder="admin.employees.placeholders.salaryChangeReason">
          </app-form-field>
        }

        <app-async-select formControlName="managerId" label="admin.employees.manager" icon="supervisor_account"
          nullOptionLabel="admin.employees.noManager" [dataSource$]="managersDataSource$" [optionMapper]="managerMapper"
          [filterFn]="managerFilter" [resetOnDataSourceChange]="false">
        </app-async-select>

        <mat-checkbox formControlName="isActive" color="primary">
          {{ 'admin.employees.isActive' | translate }}
        </mat-checkbox>
      </div>
    </div>
  </form>

</app-base-dialog>
