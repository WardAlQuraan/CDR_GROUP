<app-base-dialog
  [title]="dialogTitle"
  [saveLabel]="saveLabel"
  [saveDisabled]="!isViewMode && form.invalid"
  [loading]="loading"
  (save)="onSubmit()"
  (cancel)="onCancel()">

  <!-- Create/Edit Mode -->
  @if (isCreateMode || isEditMode) {
    <form [formGroup]="form" class="dialog-form">
      <div class="form-section section-primary">
        <div class="section-header">
          <div class="section-icon">
            <mat-icon>admin_panel_settings</mat-icon>
          </div>
          <div class="section-title">{{ 'admin.roles.roleInfo' | translate }}</div>
        </div>

        <div class="section-content">
          <app-form-field formControlName="name" label="admin.roles.name" icon="label"
            placeholder="admin.roles.placeholders.name"
            [errors]="[{name: 'required', message: 'admin.roles.errors.nameRequired'}, {name: 'minlength', message: 'admin.roles.errors.nameMinLength'}]">
          </app-form-field>

          <app-form-field formControlName="description" type="textarea" label="admin.roles.description" icon="description"
            placeholder="admin.roles.placeholders.description">
          </app-form-field>
        </div>
      </div>
    </form>
  }

  <!-- View Mode -->
  @if (isViewMode && data.role) {
    <div class="view-content">
      <div class="form-section section-primary">
        <div class="section-header">
          <div class="section-icon">
            <mat-icon>admin_panel_settings</mat-icon>
          </div>
          <div class="section-title">{{ 'admin.roles.roleInfo' | translate }}</div>
        </div>

        <div class="section-content view-fields">
          <div class="view-field">
            <span class="field-label">{{ 'admin.roles.name' | translate }}</span>
            <span class="field-value">{{ data.role.name }}</span>
          </div>
          <div class="view-field">
            <span class="field-label">{{ 'admin.roles.description' | translate }}</span>
            <span class="field-value">{{ data.role.description || '-' }}</span>
          </div>
          <div class="view-field">
            <span class="field-label">{{ 'admin.roles.type' | translate }}</span>
            <span class="field-value">
              @if (data.role.isSystemRole) {
                <mat-chip color="primary">{{ 'admin.roles.system' | translate }}</mat-chip>
              } @else {
                <mat-chip>{{ 'admin.roles.custom' | translate }}</mat-chip>
              }
            </span>
          </div>
          <div class="view-field">
            <span class="field-label">{{ 'admin.roles.created' | translate }}</span>
            <span class="field-value">{{ data.role.createdAt | date:'medium' }}</span>
          </div>
        </div>
      </div>

      <!-- Permissions List -->
      <div class="form-section section-purple">
        <div class="section-header">
          <div class="section-icon">
            <mat-icon>security</mat-icon>
          </div>
          <div class="section-title">{{ 'admin.roles.permissions' | translate }} ({{ data.role.permissions.length || 0 }})</div>
        </div>

        <div class="section-content">
          <div class="permissions-list">
            @for (permission of data.role.permissions; track permission) {
              <mat-chip>{{ permission }}</mat-chip>
            }
            @if (!data.role.permissions.length) {
              <span class="no-permissions">{{ 'admin.roles.noPermissions' | translate }}</span>
            }
          </div>
        </div>
      </div>
    </div>
  }

</app-base-dialog>
